<!DOCTYPE html>
<meta charset="utf-8">
<style>
  h1, h2  {
    margin:.75px;
  }
  body {
    background-color: #E0F0FF;
  }
  path.NZN{
    fill:#cdc;
  }
  path.NZS{
    fill:#cdc;
  }
  path.NZA{
    fill:#cdc;
  }
  path.place{
    fill:black;
  }
  text.place-label{
    font-size:9pt;
  }
  text.region-label{
    fill: gray;
    fill-opacity: .5;
    font-size: 20pt;
    font-weight: 300;
    text-anchor: middle;
  }
  circle.refugee-location-1 {
    fill: #0066CC;
  }
  rect.refugee-rect {
    fill:#FFF;
  }
  text.refugee-stats {
  }
</style>
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="jquery.tipsy.js"></script>
  <link href="tipsy.css" rel="stylesheet" type="text/css" />
  <h1>Refugee Settlement in New Zealand</h1>
  <h2>2006-2015</h3>
  <h5>Source: <a href="http://www.immigration.govt.nz/NR/rdonlyres/F4C1C566-F1B8-469A-A1B4-D48345BA283E/0/RQBResettlementStatPak.pdf">Immigration New Zealand</a></h5>
  <script>
    // create the SVG region
    var width = 600, height = 700;
    var svg = d3.select("body")
        .append("svg")
        .attr({"width":width, "height":height});
    // create the projection
    // Note that this uses the transverse mercator, which is the standard for mapping New Zealand (which is small and near a pole)
    var projection = d3.geo.transverseMercator()
        .scale(3200)
        .rotate([188,40.5])
        .translate([width/2, height/2]);
    // create the path tool
    var path = d3.geo.path()
      .projection(projection)
      .pointRadius(3);

    // grab the geography from the server
    d3.json("nz.json",function (nz) {
      var subunits = topojson.feature(nz, nz.objects.nzl_subunits),
          places = topojson.feature(nz, nz.objects.nz_places);
      // This draws the actual land masses
      // note the argument to data() where we are converting the TopoJSON data by extracting the
      // features that we want
      svg.selectAll("path")
          .data(subunits.features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("class", function (d) {return d.id;});
      // The json data also includes a collection of points of interest (major cities) as another feature
      // those are also convereted to paths, this time, becoming points
      svg.append("path")
          .datum(places)
          .attr("d", path)
          .attr("class","place")
      // we run through that same data again, this time producing labels for the points
      svg.selectAll(".place-label")
          .data(places.features)
        .enter().append("text")
          .attr("class", function(d) { return "place-label " + d.properties.name })
          .attr("transform", function(d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
        .attr("dx", ".5em")
          .text(function(d) { return d.properties.name; });
      // finally, we add in some labels for the major land masses (note which feature we are dealing with)
      var labels = svg.selectAll(".region-label")
          .data(subunits.features)
        .enter()
      .append("text")
          .attr("class", function(d) { return "region-label " + d.id; })
          .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
          .attr("dy", ".35em")
          .text(function(d) { return d.properties.name; });

      // svg.selectAll(".Auckland").each(function() {
      //   var t = document.createElement("circle");
      //   this.parentNode.insertBefore(t, this.nextSibling);
      // });

      // var coordinates = projection([6850,8653]);

      // svg.selectAll("circle")
      //   .attr("class", "refugee-location")
      //   .attr("stroke", "black")
      //   .attr("fill", "green")
      //   .attr("cx", coordinates[0])
      //   .attr("cy", coordinates[1])
      //   .attr("r", 30);

      svg.append("circle")
          .attr("class", "refugee-location-1")
          .attr("cx", 410)
          .attr("cy", 150)
          .attr("r", 10)
          .on("click", function() {
            svg.select(".refugee-rect").remove();
            svg.select(".refugee-stats").remove();
            svg.append("rect")
                .attr("class", "refugee-rect")
                .attr("x", 50)
                .attr("y", 50)
                .attr("rx", 20)
                .attr("ry", 20)
                .attr("width", 200)
                .attr("height", 100);
            svg.append("text")
                .attr("class", "refugee-stats")
                .attr("x", 95)
                .attr("y", 105)
                .text("Auckland: 2255");
          });

    });


    // $(document).ready(function() {
      // $(".refugee-location").tipsy({
      //   gravity: 'w',
      //   html: true,
      //   title: function() {
      //     var d = this.__data__, c = colors(d.i);
      //     return 'Hi there! My color is <span style="color:' + c + '">' + c + '</span>';
      //   }
      // });
    // });


    // $(window).load(function() {
    //   $(".refugee-location").on("click", function() {

    //     alert("Hello!")
    //   })
    // });
  </script>
    <canvas width="800" height="900">
      <!-- <img src="New_Zealand.png" height="700" width="700"> -->
    </canvas>
  </body>
